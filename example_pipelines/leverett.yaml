configuration:
  eo_pipelines:

    spec:
      lat_min: "67.01.12N"
      lat_max: "67.04.36N"
      lon_min: "50.09.51W"
      lon_max: "49.55.36W"
      start_date: 2013-01-01
      end_date: 2023-10-01
      max_cloud_cover_fraction: 0.1
      datasets:
        LANDSAT_OT_C2_L1:
          bands: [ 1,2,3,4,5,6,7,8,9,10,11,QA_PIXEL ]
        LANDSAT_OT_C2_L2:
          bands: [ ST,ST_QA ]
    environment:
      working_directory: /gws/nopw/j04/lake_icesheet/leverett
      conda_path: /home/users/niallmcc/miniconda3/bin/conda
      shell: "/bin/bash"
      echo_stdout: True

nodes:
  n0:
    type: eo_pipelines:usgs_search
    properties:
      configuration:
        output_path: /gws/nopw/j04/lake_icesheet/leverett/list
  n1:
    type: eo_pipelines:usgs_fetch
    properties:
      configuration:
        output_path: /gws/nopw/j04/lake_icesheet/leverett/fetched
  n2:
    type: eo_pipelines:usgs_import
    properties:
      executor_settings:
        executor: local
        local:
          nr_threads: 4
      configuration:
        output_path: /gws/nopw/j04/lake_icesheet/leverett/imported
  n3:
    type: eo_pipelines:usgs_group
    properties:
      configuration:
        output_path: /gws/nopw/j04/lake_icesheet/leverett/grouped
  n4:
    type: eo_pipelines:xesmf_regrid
    properties:
      configuration:
        target_grid_path: {target_grid_path}
        max_distance: 50
        cache_path: regridder_cache
        output_path: regridded
      executor_settings:
        can_skip: true
  n5:
    type: eo_pipelines:missing_filter
    properties:
      configuration:
        band: B2
        max_missing_fraction: 0.5
      executor_settings:
        can_skip: true
  n6:
    type: eo_pipelines:time_stacker
    properties:
      configuration:
        output_filename: MARGINALLAKES{id}-L1L2-Landsat89-v2.0-fv01.0.nc
        output_path: stacked
      executor_settings:
        can_skip: true
  n7:
    type: eo_pipelines:add_masks
    properties:
      configuration:
        layer_names: {lake_variables}
        layer_paths: {lake_masks}
        output_path: masked
      executor_settings:
        can_skip: true
links:
  - n0 => n1
  - n1 => n2
  - n2 => n3
  - n3 => n4
  - n4 => n5
  - n5 => n6
  - n6 => n7